# LOCAL DEVELOPMENT OVERRIDES
# Usage: docker-compose -f docker-compose.yml -f infra/docker/compose/docker-compose.local.yml up -d

services:
  # ===================
  # WAF (Local - Detection Only)
  # ===================
  waf:
    environment:
      - MODSEC_RULE_ENGINE=DetectionOnly
      - PARANOIA=1
    # Use self-signed certs for local HTTPS (optional)
    # volumes:
    #   - ./infra/docker/nginx/ssl:/etc/nginx/ssl:ro

  backend:
    environment:
      - APP_ENV=local
      - APP_DEBUG=true
      - LOG_LEVEL=debug
    extra_hosts:
      - "host.docker.internal:host-gateway"

  queue:
    environment:
      - APP_ENV=local
      - APP_DEBUG=true
      - LOG_LEVEL=debug

  scheduler:
    environment:
      - APP_ENV=local
      - APP_DEBUG=true

  # Enable Xdebug for local development
  # backend:
  #   build:
  #     args:
  #       - XDEBUG_ENABLED=true

  mysql:
    ports:
      - "3307:3306" # Use 3307 externally to avoid conflict with local MySQL

  redis:
    ports:
      - "6379:6379"

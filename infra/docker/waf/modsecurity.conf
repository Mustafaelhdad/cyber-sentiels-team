# ===================
# MODSECURITY MAIN CONFIG
# ===================
# This file is loaded by the owasp/modsecurity-crs image
# Env-driven: WAF_MODE (DetectionOnly or On), WAF_PARANOIA (1-4)

# Rule Engine (env: MODSEC_RULE_ENGINE)
# DetectionOnly = log but don't block
# On = enforce blocking
SecRuleEngine ${MODSEC_RULE_ENGINE}

# Request Body Handling
SecRequestBodyAccess On
SecRequestBodyLimit 13107200
SecRequestBodyNoFilesLimit 131072
SecRequestBodyLimitAction Reject

# Response Body Handling
SecResponseBodyAccess On
SecResponseBodyMimeType text/plain text/html text/xml application/json
SecResponseBodyLimit 524288
SecResponseBodyLimitAction ProcessPartial

# Temp files
SecTmpDir /tmp/
SecDataDir /tmp/

# Audit Logging
SecAuditEngine RelevantOnly
SecAuditLogRelevantStatus "^(?:5|4(?!04))"
SecAuditLogParts ABIJDEFHZ
SecAuditLogType Serial
SecAuditLog /var/log/modsecurity/modsec_audit.log

# Debug logging (off in prod)
SecDebugLog /var/log/modsecurity/modsec_debug.log
SecDebugLogLevel 0

# PCRE limits
SecPcreMatchLimit 100000
SecPcreMatchLimitRecursion 100000

# Unicode mapping
SecUnicodeMapFile unicode.mapping 20127

# Status on error
SecStatusEngine On


